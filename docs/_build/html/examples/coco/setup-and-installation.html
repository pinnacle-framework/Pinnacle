<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Setup and installation &mdash; SuperDuperDB  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/nbsphinx-code-cells.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Inserting and getting data" href="inserting-and-getting-data.html" />
    <link rel="prev" title="CoCo (Common Objects in Context) Dataset" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            SuperDuperDB
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Quick  start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../minimum_working_example.html">Minimum working example</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../mnist-notebook.html">MNIST: Handwritten digit recognition with SuperDuperDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dc-gan.html">Bespoke training loop using GAN on Celeb Dataset</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">CoCo (Common Objects in Context) Dataset</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Setup and installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="inserting-and-getting-data.html">Inserting and getting data</a></li>
<li class="toctree-l3"><a class="reference internal" href="text-2-image-retrieval-with-clip.html">Text-2-Image document retrieval using pretrained CLIP</a></li>
<li class="toctree-l3"><a class="reference internal" href="bespoke-retriever-using-clip-embeddings.html">Bespoke retrieval based on CLIP embedding vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="attribute-prediction.html">Attribute prediction using “imputations” with preparation in SpaCy</a></li>
<li class="toctree-l3"><a class="reference internal" href="image-captioning.html">Image captioning using recurrent language modelling and transfer learning based on CLIP</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../types.html">Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../content.html">Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchers.html">Watchers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../semantic_indexes.html">Semantic indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../imputations.html">Imputations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jobs.html">Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cluster.html">Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../full_usage.html">Full usage</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SuperDuperDB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Examples</a></li>
          <li class="breadcrumb-item"><a href="index.html">CoCo (Common Objects in Context) Dataset</a></li>
      <li class="breadcrumb-item active">Setup and installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/examples/coco/setup-and-installation.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Setup-and-installation">
<h1>Setup and installation<a class="headerlink" href="#Setup-and-installation" title="Permalink to this heading"></a></h1>
<p>SuperDuperDB uses MongoDB for data storage. If you haven’t done so already, install it using the following lines of bash.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>-qO<span class="w"> </span>-<span class="w"> </span>https://www.mongodb.org/static/pgp/server-6.0.asc<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>gnupg
wget<span class="w"> </span>-qO<span class="w"> </span>-<span class="w"> </span>https://www.mongodb.org/static/pgp/server-6.0.asc<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/mongodb-org-6.0.list
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>mongodb-org
</pre></div>
</div>
<p>If you haven’t downloaded the data already, execute the lines of bash below. We’ve tried to keep it clean, and for reasons of efficiency have resized the images using imagemagick:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>http://images.cocodataset.org/annotations/annotations_trainval2014.zip<span class="w"> </span>-o<span class="w"> </span>raw.zip
unzip<span class="w"> </span>raw.zip
curl<span class="w"> </span>http://images.cocodataset.org/zips/train2014.zip<span class="w"> </span>-o<span class="w"> </span>images.zip
unzip<span class="w"> </span>-q<span class="w"> </span>images.zip
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>imagemagick
mogrify<span class="w"> </span>-resize<span class="w"> </span>224x<span class="w"> </span><span class="s1">&#39;train2014/*.jpg&#39;</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>data/coco
mv<span class="w"> </span>train2014<span class="w"> </span>data/coco/images
mv<span class="w"> </span>annotations/*<span class="w"> </span>data/coco
rm<span class="w"> </span>raw.zip
rm<span class="w"> </span>images.zip
</pre></div>
</div>
<p>In case you haven’t done so already, install the dependencies for this tutorial, including SuperDuperDB, which is a simple pip install:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>pandas
pip<span class="w"> </span>install<span class="w"> </span>pillow
pip<span class="w"> </span>install<span class="w"> </span>torch
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>../../requirements.txt
</pre></div>
</div>
<p>SuperDuperDB can handle data in any format, including images. The documents in the database are MongoDB <code class="docutils literal notranslate"><span class="pre">bson</span></code> documents, which mix <code class="docutils literal notranslate"><span class="pre">json</span></code> with raw bytes and <code class="docutils literal notranslate"><span class="pre">ObjectId</span></code> objects. SuperDuperDB takes advantage of this by serializing more sophisticated objects to bytes, and reinstantiating the objects in memory, when data is queried.</p>
<p>In order to tell SuperDuperDB what type an object has, one specifies this with a subdocument of the form:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
    &quot;_content&quot;: {
        &quot;bytes&quot;: ...,
        &quot;type&quot;: &quot;&lt;my-type&gt;&quot;,
    }
}
</pre></div>
</div>
<p>If however, the content is located on the web or the filesystem, one can specify the URLs directly:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;url-or-file&gt;&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;my-type&gt;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Let’s see this now in action. We reformat the CoCo data, so that each image is associated in one document with all of the captions which describe it, and add the location of the images using the <code class="docutils literal notranslate"><span class="pre">_content</span></code> keyword.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/coco/captions_train2014.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">raw</span><span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">]}</span>

<span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">]:</span>
    <span class="n">raw</span><span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">][</span><span class="n">im</span><span class="p">][</span><span class="s1">&#39;captions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">[</span><span class="s1">&#39;annotations&#39;</span><span class="p">]:</span>
    <span class="n">raw</span><span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">][</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;image_id&#39;</span><span class="p">]][</span><span class="s1">&#39;captions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;caption&#39;</span><span class="p">])</span>

<span class="n">raw</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">raw</span><span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">raw</span><span class="p">):</span>
    <span class="c1"># if image is already in memory, then add &#39;bytes&#39;: b&#39;...&#39; instead of &#39;url&#39;: &#39;...&#39;</span>
    <span class="c1"># for content located on the web, use &#39;http://&#39; or &#39;https://&#39; instead of &#39;file://&#39;</span>
    <span class="n">im</span><span class="p">[</span><span class="s1">&#39;img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;_content&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;file://data/coco/images/</span><span class="si">{</span><span class="n">im</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;image&#39;</span><span class="p">}</span>
    <span class="p">}</span>
    <span class="n">raw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;captions&#39;</span><span class="p">:</span> <span class="n">im</span><span class="p">[</span><span class="s1">&#39;captions&#39;</span><span class="p">],</span> <span class="s1">&#39;img&#39;</span><span class="p">:</span> <span class="n">im</span><span class="p">[</span><span class="s1">&#39;img&#39;</span><span class="p">]}</span>

<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">raw</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[
  {
    &#34;captions&#34;: [
      &#34;A restaurant has modern wooden tables and chairs.&#34;,
      &#34;A long restaurant table with rattan rounded back chairs.&#34;,
      &#34;a long table with a plant on top of it surrounded with wooden chairs &#34;,
      &#34;A long table with a flower arrangement in the middle for meetings&#34;,
      &#34;A table is adorned with wooden chairs with blue accents.&#34;
    ],
    &#34;img&#34;: {
      &#34;_content&#34;: {
        &#34;url&#34;: &#34;file://data/coco/images/COCO_train2014_000000057870.jpg&#34;,
        &#34;type&#34;: &#34;image&#34;
      }
    }
  },
  {
    &#34;captions&#34;: [
      &#34;A man preparing desserts in a kitchen covered in frosting.&#34;,
      &#34;A chef is preparing and decorating many small pastries.&#34;,
      &#34;A baker prepares various types of baked goods.&#34;,
      &#34;a close up of a person grabbing a pastry in a container&#34;,
      &#34;Close up of a hand touching various pastries.&#34;
    ],
    &#34;img&#34;: {
      &#34;_content&#34;: {
        &#34;url&#34;: &#34;file://data/coco/images/COCO_train2014_000000384029.jpg&#34;,
        &#34;type&#34;: &#34;image&#34;
      }
    }
  }
]
</pre></div></div>
</div>
<p>You can see that we’ve slightly reformatted the data in preparation for injestion to SuperDuperDB. That’s so that SuperDuperDB knows how to handle the content behind the URLs or file paths for the images. We’ll learn more about that in the next chapter.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/coco/data.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="CoCo (Common Objects in Context) Dataset" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="inserting-and-getting-data.html" class="btn btn-neutral float-right" title="Inserting and getting data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Duncan Blythe duncan@pinnacledb.com.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>